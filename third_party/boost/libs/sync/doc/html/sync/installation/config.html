<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Configuring and building the library</title>
<link rel="stylesheet" href="../../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="../../index.html" title="Chapter 1. Boost.Sync v1">
<link rel="up" href="../installation.html" title="Installation and compatibility">
<link rel="prev" href="../installation.html" title="Installation and compatibility">
<link rel="next" href="../reference.html" title="Reference">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr><td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../boost.png"></td></tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../installation.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../installation.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="../reference.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="sync.installation.config"></a><a class="link" href="config.html" title="Configuring and building the library">Configuring and building the
      library</a>
</h3></div></div></div>
<div class="toc"><dl class="toc">
<dt><span class="section"><a href="config.html#sync.installation.config.compiler_tls">Notes about
        compiler-supplied intrinsics for TLS</a></span></dt>
<dt><span class="section"><a href="config.html#sync.installation.config.pthreads_win32">Selecting
        threading API on Windows</a></span></dt>
</dl></div>
<p>
        Most of the components provided by the library are header-only and do not
        require linking with Boost.Sync. Currently <code class="computeroutput"><span class="identifier">at_thread_exit</span></code>,
        <code class="computeroutput"><span class="identifier">notify_all_at_thread_exit</span></code>
        and <code class="computeroutput"><span class="identifier">thread_specific_ptr</span></code> require
        linking with prebuilt library. In order to build Boost.Sync, follow the common
        <a href="https://www.boost.org/doc/libs/release/more/getting_started/" target="_top">Getting
        Started</a> guide for your platform.
      </p>
<p>
        Boost.Sync supports a number of macros to configure its implementation and
        behavior. These macros are given in the following table. These macros should
        be defined similarly when building Boost and your code using Boost.Sync.
      </p>
<div class="table">
<a name="sync.installation.config.configuration_macros"></a><p class="title"><b>Table 1.1. Configuration macros</b></p>
<div class="table-contents"><table class="table" summary="Configuration macros">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  Macro name
                </p>
              </th>
<th>
                <p>
                  Effect
                </p>
              </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">BOOST_USE_WINAPI_VERSION</span></code>
                </p>
              </td>
<td>
                <p>
                  This macro is Windows-specific. Selects the target Windows version
                  for various Boost libraries, including Boost.Sync. Code compiled
                  for a particular Windows version will likely fail to run on the
                  older Windows versions, but may improve performance because of
                  using newer OS features. The macro is expected to have an integer
                  value equivalent to <a href="https://msdn.microsoft.com/en-us/library/6sehtctf.aspx" target="_top"><code class="computeroutput"><span class="identifier">_WIN32_WINNT</span></code></a>.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">BOOST_SYNC_USE_COMPILER_TLS</span></code>
                </p>
              </td>
<td>
                <p>
                  This macro enables support for compiler intrinsics for thread-local
                  storage. Defining it may improve performance of Boost.Sync if certain
                  usage limitations are acceptable. See <a class="link" href="config.html#sync.installation.config.compiler_tls" title="Notes about compiler-supplied intrinsics for TLS">below</a>
                  for more comments.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">BOOST_SYNC_USE_PTHREAD</span></code>
                </p>
              </td>
<td>
                <p>
                  This macro forces using pthreads API on Windows. See <a class="link" href="config.html#sync.installation.config.pthreads_win32" title="Selecting threading API on Windows">below</a>
                  for more details.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">BOOST_SYNC_USE_STD_SYSTEM_ERROR</span></code>
                </p>
              </td>
<td>
                <p>
                  When defined, instructs Boost.Sync to use <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">system_error</span></code>
                  and <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">error_code</span></code> instead of <a href="http://www.boost.org/doc/libs/release/libs/system/doc/index.html" target="_top">Boost.System</a>.
                </p>
              </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
        You can define configuration macros in the <code class="computeroutput"><span class="identifier">b2</span></code>
        command line, like this:
      </p>
<pre class="programlisting">b2 -j8 --with-sync variant=release define=BOOST_SYNC_USE_COMPILER_TLS define=BOOST_USE_WINAPI_VERSION=0x0601 stage
</pre>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="sync.installation.config.compiler_tls"></a><a class="link" href="config.html#sync.installation.config.compiler_tls" title="Notes about compiler-supplied intrinsics for TLS">Notes about
        compiler-supplied intrinsics for TLS</a>
</h4></div></div></div>
<p>
          Many widely used compilers support builtin intrinsics for managing thread-local
          storage, which is used in the components of the library which require TLS.
          This feature is also included in the C++11 standard. Generally, these intrinsics
          allow for a much more efficient access to the storage than any surrogate
          implementation, including native operating system API. However, this feature
          has several caveats:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              Some operating systems don't support the use of these intrinsics in
              case if the TLS is defined in a shared library that is dynamically
              loaded during the application run time. These systems include Linux
              and Windows prior to Vista. Windows Vista and later do not have this
              issue.
            </li>
<li class="listitem">
              The TLS may not be reliably accessed from global constructors and destructors.
              At least MSVC 8.0 on Windows is known to have this problem.
            </li>
</ul></div>
<p>
          The library provides the <code class="computeroutput"><span class="identifier">BOOST_SYNC_USE_COMPILER_TLS</span></code>
          configuration macro that allows to enable the use of this feature, which
          will improve the library performance at the cost of these limitations:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              The application executable must be linked with the Boost.Log library.
              It should not be loaded dynamically during run time.
            </li>
<li class="listitem">
              The application must not use TLS in global constructors or destructors.
            </li>
</ul></div>
<p>
          Note that enabling builtin compiler support for TLS does not remove the
          dependency on lower level OS threading primitives implementing TLS. The
          purpose of using compiler intrinsics for TLS is better performance rather
          than reducing dependencies.
        </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="sync.installation.config.pthreads_win32"></a><a class="link" href="config.html#sync.installation.config.pthreads_win32" title="Selecting threading API on Windows">Selecting
        threading API on Windows</a>
</h4></div></div></div>
<p>
          Boost.Sync supports building against one of the following underlying APIs:
          pthreads or Windows API. On most platforms pthreads are the only option.
          On Windows, Windows API is used by default, but pthreads can be enabled.
          One implementation of pthreads on Windows is <a href="http://sourceware.org/pthreads-win32" target="_top">pthreads-win32</a>.
        </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
            Cygwin is considered a POSIX-compatible platform, which provides pthreads
            API.
          </p></td></tr>
</table></div>
<p>
          To select pthreads on Windows, do the following:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
              Set <code class="computeroutput"><span class="identifier">PTW32_INCLUDE</span></code> variable
              to the path to pthread-win32 headers and <code class="computeroutput"><span class="identifier">PTW32_LIB</span></code>
              to the path to pthread-win32 library. These variables can be set in
              the environment, <code class="computeroutput"><span class="identifier">user</span><span class="special">-</span><span class="identifier">config</span><span class="special">.</span><span class="identifier">jam</span></code>
              or <code class="computeroutput"><span class="identifier">site</span><span class="special">-</span><span class="identifier">config</span><span class="special">.</span><span class="identifier">jam</span></code>. For example, add the following
              lines to your <code class="computeroutput"><span class="identifier">user</span><span class="special">-</span><span class="identifier">config</span><span class="special">.</span><span class="identifier">jam</span></code>
              (delimiting spaces are significant):
            </li></ul></div>
<pre class="programlisting">PTW32_INCLUDE = "C:\Program Files\ptw32\Pre-built2\include" ;
PTW32_LIB = "C:\Program Files\ptw32\Pre-built2\lib" ;
</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
              Add <code class="computeroutput"><span class="identifier">threadapi</span><span class="special">=</span><span class="identifier">pthread</span></code> to <code class="computeroutput"><span class="identifier">b2</span></code>
              command line, for example:
            </li></ul></div>
<pre class="programlisting">b2 -j8 --with-sync variant=release threadapi=pthread stage
</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
              When building your code that uses Boost.Sync, define <code class="computeroutput"><span class="identifier">BOOST_SYNC_USE_PTHREAD</span></code> macro. Make
              sure paths to pthread-win32 headers and libraries are also configured
              in your project and you're linking with pthread-win32 pre-built library.
            </li></ul></div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright © 2013 Vicente J. Botet Escriba, Tim Blechmann<br>Copyright © 2013-2019 Andrey Semashev<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>).
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../installation.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../installation.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="../reference.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
